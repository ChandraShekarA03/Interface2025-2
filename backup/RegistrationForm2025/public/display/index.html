<!DOCTYPE html>
<html>
    <head>
        <style>
            body {
                background-color: #e0e0e0;
            }

            table {
                background-color: inherit;
                color: #1f1f1f;
                border-collapse: collapse;
                margin-bottom: 10px;
            }

            th, td {
                border: 1px solid #1f1f1f;
            }

            .page {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 7px;
            }

            .page > span {
                display: inline-block;
                width: fit-content;
                height: fit-content;
            }

            .current_page_input {
                width: 14px;
                text-align: end;
            }
        </style>
    </head>
    <body>
        <table class="table"></table>
        <div class="page">
            <input class="prev_page_button" type="button" value="&lt;">
            <input class="current_page_input" type="text">
            <span>/ </span>
            <span class="last_page_span"></span>
            <input class="next_page_button" type="button" value="&gt;">
        </div>
        <script>
            const table = document.querySelector(".table");
            const prev_page_button = document.querySelector(".prev_page_button");
            const current_page_input = document.querySelector(".current_page_input");
            const last_page_span = document.querySelector(".last_page_span");
            const next_page_button = document.querySelector(".next_page_button");

            next_page_button.onclick = () => turnPage(parseInt(current_page_input.value) + 1);
            prev_page_button.onclick = () => turnPage(parseInt(current_page_input.value) - 1);

            function turnPage(new_page) {
                fetch("/display", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        page: new_page
                    })
                })
                .then(response => response.json())
                .then(response => {
                    const {last_page, data} = response;
                    new_page = response.page;
                    const headings = [
                        "name",
                        "email",
                        "event",
                        "paymentScreenshot",
                        "timestamp"
                    ];
                    const normal_headings = [
                        "Name",
                        "Email",
                        "Event",
                        "Payment Screenshot",
                        "Timestamp"
                    ];
                    table.innerHTML = "";
                    const head_row = table.insertRow();
                    normal_headings.forEach(heading => {
                        const new_th = document.createElement("th");
                        new_th.appendChild(document.createTextNode(heading));
                        head_row.appendChild(new_th);
                    });
                    data.forEach(ob => {
                        const new_row = table.insertRow();
                        headings.forEach(heading => {
                            const new_cell = new_row.insertCell();
                            new_cell.appendChild(document.createTextNode(ob[heading]));
                        });
                    });
                    current_page_input.value = new_page;
                    last_page_span.textContent = last_page;
                });
            }

            current_page_input.onkeypress = event => {
                var charCode = (event.which) ? event.which : event.keyCode
                if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                    return false;
                } else if (charCode === 13) {
                    turnPage(parseInt(current_page_input.value));
                }
            }

            current_page_input.onblur = () => turnPage(parseInt(current_page_input.value));

            turnPage(1);
        </script>
    </body>
</html>